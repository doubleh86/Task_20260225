# 코드 분석 및 수정 권장 사항

아래 항목들은 현재 코드 기준으로 **실제 운영 시 문제를 만들 가능성이 높은 순서**로 정리했습니다.

## 1) 테스트 코드와 서비스 동작 불일치 (우선순위: 높음)

- `ContactCacheService.AddContactList`는 유효성 실패 시 예외를 던지지 않고 `failed` 카운트만 증가시킵니다.
- 그런데 `TaskTest/ContactCacheServiceTest.cs`의 일부 테스트는 `ServerException` 예외 발생을 기대하고 있습니다.

### 영향
- 테스트 신뢰도 저하 (실제 정책과 테스트 정책이 다름)
- CI 환경에서 테스트 실패 가능성

### 권장 수정
둘 중 하나로 정책을 통일하세요.

1. **현재 구현 유지(권장)**: 잘못된 데이터는 스킵하고 실패 건수만 반환
   - 이 경우 테스트를 `예외 기대`에서 `failed count 검증`으로 변경
2. **예외 중심 정책으로 변경**: 첫 오류에서 업로드 중단
   - 이 경우 `UploadEmployeeInfoHandler` 반환 스펙(`success/failed`)과 충돌하므로 API 계약 재정의 필요

---

## 2) 중복 데이터 처리 통계가 실제 입력과 불일치 가능 (우선순위: 높음)

- `AddContactList`는 이메일 중복을 선필터링하지만, 중복 건수를 `failed`에 반영하지 않습니다.
- 결과적으로 `입력 건수 != successCount + failedCount`가 될 수 있습니다.

### 영향
- 업로드 결과 리포트가 사용자 입장에서 혼란스러움
- 모니터링/정산 로직에서 오류 가능성

### 권장 수정
- 중복을 별도 카운트(`duplicatedCount`)로 노출하거나,
- 중복도 `failedCount`에 포함시키는 정책으로 통일

---

## 3) CSV 파서가 단순 split 기반이라 포맷 안정성이 낮음 (우선순위: 중간)

- 현재 CSV 처리(`line.Split(',')`)는 따옴표, 이스케이프, 컬럼 내 콤마를 처리하지 못합니다.
- 헤더가 있는 CSV인지도 구분하지 않습니다.

### 영향
- 정상 CSV를 잘못 파싱하거나, 실제 데이터가 손상되어 저장될 수 있음

### 권장 수정
- `CsvHelper` 같은 라이브러리 도입 또는 최소한 헤더 처리/quoted field 처리 추가
- 허용 포맷(JSON/CSV)의 구체 스펙을 README에 명시

---

## 4) 런타임/빌드 의존성(.NET 10)으로 개발 환경 제약 큼 (우선순위: 중간)

- README와 프로젝트가 `net10.0`을 전제로 합니다.
- 일반 개발 환경/CI에서 SDK 부재로 빌드 및 테스트 실패 가능성이 큽니다.

### 권장 수정
- 팀 표준 버전이 확정되지 않았다면 `net8.0` LTS 검토
- 최소한 `global.json`으로 SDK 버전을 고정해 재현성 확보

---

## 5) 에러코드 정의와 실제 사용 간 결합도 약함 (우선순위: 낮음)

- `ErrorCode.ContactInvalidEmailFormat`, `ContactInvalidDateFormat`가 정의되어 있으나,
  현재 핵심 경로에서는 예외 발생 없이 로그 후 스킵합니다.

### 영향
- 유지보수자가 “왜 코드가 있는데 안 쓰지?”라는 혼동을 겪음

### 권장 수정
- 미사용 코드 정리 또는 실제 정책과 맞게 사용처 추가
- 정책 문서화(“검증 실패는 스킵/집계” 등)

---

## 빠른 개선 로드맵(실행 순서)

1. **정책 정리**: invalid/duplicate 처리 정책 확정
2. **테스트 정렬**: 정책에 맞게 `TaskTest` 갱신
3. **응답 모델 명확화**: 필요 시 `duplicatedCount` 추가
4. **CSV 안정화**: 파서 개선
5. **SDK 재현성 확보**: `global.json` 도입 검토

